!function(){var now;function getSetters(gl,prog,obj,pfx,depth){if(!obj)return;if((depth=depth+1||0)>10)return void console.error("Nesting limit exceeded: "+pfx);function getSetter(gl,path,val){let loc=gl.getUniformLocation(prog,path);if(!isNaN(val))return function(gl,loc){return function(val){gl.uniform1f(loc,val)}}(gl,loc);switch(val.length){case 1:return function(gl,loc){return function(val){gl.uniform1f(loc,val[0])}}(gl,loc);case 2:return function(gl,loc){return function(val){gl.uniform2f(loc,val[0],val[1])}}(gl,loc);case 3:return function(gl,loc){return function(val){gl.uniform3f(loc,val[0],val[1],val[2])}}(gl,loc);case 4:return function(gl,loc){return function(val){gl.uniform4f(loc,val[0],val[1],val[2],val[3])}}(gl,loc)}}pfx=pfx||"";let setters={setters:{}};for(let k in obj)if(isNaN(obj[k]))if(obj[k]instanceof Array)if(isNaN(obj[k][0])){setters.setters[k]={setters:{}};for(let i=0;i<obj[k].length;i++)setters.setters[k].setters[i]=getSetters(gl,prog,obj[k][i],pfx+k+"["+i+"].",depth)}else setters[k]=getSetter(gl,pfx+k,obj[k]);else setters.setters[k]=getSetters(gl,prog,obj[k],pfx+k+".",depth);else setters[k]=getSetter(gl,pfx+k,obj[k]);return setters}now=performance&&performance.now?function(){return performance.now()}:function(){return(new Date).getTime()},window.not3=function(options){var cvs,gl,glTEXTURE,buffer,program,vertex_position,uniforms=options&&options.uniforms||{},uniformSetters={},texActivators=[],start_time=now(),scaling=options&&options.scaling||1,version="";options===typeof Element&&((options=arguments[1]).canvas=arguments[0]),options||(options={}),cvs=options.canvas||document.querySelector("canvas"),options.fragment||(options.fragment=document.getElementById("fs").textContent.trim());let ln=options.fragment.indexOf("\n");function init(){try{gl=cvs.getContext("webgl2",{antialias:!1})||cvs.getContext("webgl")}catch(e){}if(!gl)throw"cannot create webgl context";var texInfo;glTEXTURE=[gl.TEXTURE0,gl.TEXTURE1,gl.TEXTURE2,gl.TEXTURE3,gl.TEXTURE4,gl.TEXTURE5,gl.TEXTURE6,gl.TEXTURE7],buffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),gl.STATIC_DRAW),options.textures&&(texInfo=loadTextures(options.textures)),program=createProgram(options.vertex,options.fragment),texActivators=texInfo.map(function(t){return function(t){var loc=gl.getUniformLocation(program,t.name);return function(){gl.uniform1i(loc,t.index),gl.activeTexture(glTEXTURE[t.index]),gl.bindTexture(gl.TEXTURE_3D,t.texture)}}(t)}),uniforms.time=0,uniforms.resolution=[0,0],uniformSetters=getSetters(gl,program,uniforms)}function createProgram(vertex,fragment){var prog=gl.createProgram(),vs=createShader(vertex,gl.VERTEX_SHADER);(fragment=fragment.trim()).indexOf("precision")<0&&(fragment="#ifdef GL_ES\n  precision highp float;\n#endif\n\n"+fragment);var fs=createShader(version+"\n"+fragment,gl.FRAGMENT_SHADER);if(vs&&fs)return gl.attachShader(prog,vs),gl.attachShader(prog,fs),gl.deleteShader(vs),gl.deleteShader(fs),gl.linkProgram(prog),gl.getProgramParameter(prog,gl.LINK_STATUS)||console.warn("ERROR - Validate status: "+gl.getProgramParameter(prog,gl.VALIDATE_STATUS)+'\n\n"'+gl.getError()+'"'),prog}function createShader(src,type){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(console.error((type==gl.VERTEX_SHADER?"VERTEX":"FRAGMENT")+" SHADER:\n"+gl.getShaderInfoLog(shader)),void console.warn(src.split("\n").map(function(s,i){return i+": "+s}).join("\n")))}function loadTextures(textures){function load2d(t){if(t.data.constructor===Uint8Array)return gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),void gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,t.resolution[0],t.resolution[1],0,gl.RGBA,gl.UNSIGNED_BYTE,t.data);console.error("failed to load texture",t)}function load3d(t){if(t.data.constructor===Uint8Array){var sz=t.resolution[0]*t.resolution[1]*t.resolution[2];return gl.texParameteri(gl.TEXTURE_3D,gl.TEXTURE_BASE_LEVEL,0),gl.texParameteri(gl.TEXTURE_3D,gl.TEXTURE_MAX_LEVEL,Math.log2(sz)),gl.texParameteri(gl.TEXTURE_3D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.texParameteri(gl.TEXTURE_3D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texImage3D(gl.TEXTURE_3D,0,gl.R8,t.resolution[0],t.resolution[1],t.resolution[2],0,gl.RED,gl.UNSIGNED_BYTE,t.data),void gl.generateMipmap(gl.TEXTURE_3D)}console.error("failed to load texture",t)}return textures.map(function(t,i){let tex=gl.createTexture(),ttype=2===t.resolution.length?gl.TEXTURE_2D:gl.TEXTURE_3D;return gl.activeTexture(glTEXTURE[i]),gl.bindTexture(ttype,tex),2===t.resolution.length?load2d(t):3===t.resolution.length&&load3d(t),{index:i,name:t.name,texture:tex,type:ttype}})}function resizeCanvas(){cvs.width==cvs.clientWidth&&cvs.height==cvs.clientHeight||(cvs.width=cvs.clientWidth*scaling,cvs.height=cvs.clientHeight*scaling,uniforms.resolution=[cvs.width,cvs.height],gl.viewport(0,0,cvs.width,cvs.height))}function animate(){resizeCanvas(),render(),requestAnimationFrame(animate)}function render(){if(!program)return;gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.useProgram(program);let delta=now()-uniforms.time;uniforms.time=.001*(now()-start_time),options.update&&options.update(uniforms,delta),setUniforms(uniforms,uniformSetters),texActivators.forEach(function(x){x()}),gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.vertexAttribPointer(vertex_position,2,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(vertex_position),gl.drawArrays(gl.TRIANGLES,0,6),gl.disableVertexAttribArray(vertex_position)}function setUniforms(obj,setters){if(setters)for(let k in obj)setters[k]?setters[k]instanceof Function&&setters[k](obj[k]):setUniforms(obj[k],setters.setters[k])}version=options.fragment.indexOf("#version")<0?"":options.fragment.substr(0,ln+1),options.fragment=options.fragment.substr(ln),options.vertex||(options.vertex=version+(version.indexOf("300")<0?"attribute vec3 position;\nvoid main() { gl_Position = vec4( position, 1.0 ); }":"in vec3 position;\nvoid main() { gl_Position = vec4( position, 1.0 ); }")),init(),requestAnimationFrame(animate)}}();